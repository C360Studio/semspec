# Production Caddy configuration
# Serves static UI files and proxies API requests to semspec backend

:8080 {
    # API routes to semspec backend
    handle /agentic-dispatch/* {
        reverse_proxy semspec:8080
    }

    handle /graphql {
        reverse_proxy semspec:8082
    }

    handle /health {
        reverse_proxy semspec:8080
    }

    handle /readyz {
        reverse_proxy semspec:8080
    }

    handle /metrics {
        reverse_proxy semspec:8080
    }

    # Static UI files (SPA fallback for client-side routing)
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }
}
