# OpenAPI 3.0 Specification for Semspec API
# Generated by openapi-generator tool
# DO NOT EDIT MANUALLY - This file is auto-generated from service registrations

openapi: 3.0.3
info:
    title: Semspec API
    description: HTTP API for semantic development agent - constitution management, AST indexing, and development workflow automation
    version: 1.0.0
servers:
    - url: http://localhost:8080
      description: Development server
paths:
    /api/constitution/:
        get:
            summary: Get constitution
            description: Returns the current project constitution with all sections and rules
            tags:
                - Constitution
            responses:
                "200":
                    description: Constitution with all sections and rules
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ConstitutionResponse'
    /api/constitution/check:
        post:
            summary: Check content
            description: Check content against all constitution rules and return violations and warnings
            tags:
                - Constitution
            responses:
                "200":
                    description: Check result with pass/fail status, violations, and warnings
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HTTPCheckResponse'
                "400":
                    description: Invalid request (missing content field)
    /api/constitution/reload:
        post:
            summary: Reload constitution
            description: Reload the constitution from the configured file path
            tags:
                - Constitution
            responses:
                "200":
                    description: Reload result with success status and rule count
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ReloadResponse'
                "500":
                    description: Failed to reload constitution
    /api/constitution/rules:
        get:
            summary: Get all rules
            description: Returns all rules across all sections with their section information
            tags:
                - Constitution
            responses:
                "200":
                    description: List of all rules with section metadata
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RulesResponse'
    /api/constitution/rules/{section}:
        get:
            summary: Get rules by section
            description: Returns rules for a specific section (code_quality, testing, security, architecture)
            tags:
                - Constitution
            parameters:
                - name: section
                  in: path
                  required: true
                  description: 'Section name: code_quality, testing, security, or architecture'
                  schema:
                    type: string
            responses:
                "200":
                    description: Rules for the specified section
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/SectionRulesResponse'
                "400":
                    description: Invalid section name
    /config/{name}:
        get:
            summary: Get component configuration
            description: Returns the current configuration for a specific component
            tags:
                - Components
            parameters:
                - name: name
                  in: path
                  required: true
                  description: Component name
                  schema:
                    type: string
            responses:
                "200":
                    description: Component configuration
                    content:
                        application/json:
                            schema:
                                type: object
                "404":
                    description: Component not found
    /deployment/{id}/deploy:
        post:
            summary: Deploy flow
            description: Deploys a flow to the runtime
            tags:
                - Deployment
            responses:
                "200":
                    description: Flow deployed
                "400":
                    description: Validation errors
    /deployment/{id}/start:
        post:
            summary: Start flow
            description: Starts a deployed flow
            tags:
                - Deployment
            responses:
                "200":
                    description: Flow started
    /deployment/{id}/stop:
        post:
            summary: Stop flow
            description: Stops a running flow
            tags:
                - Deployment
            responses:
                "200":
                    description: Flow stopped
    /entries:
        get:
            summary: Get recent message entries
            description: Returns the most recent logged messages from the circular buffer
            tags:
                - MessageLogger
            parameters:
                - name: limit
                  in: query
                  description: 'Maximum number of entries to return (default: 100, max: 10000)'
                  schema:
                    type: integer
                - name: subject
                  in: query
                  description: Filter by NATS subject pattern
                  schema:
                    type: string
            responses:
                "200":
                    description: List of message entries
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/MessageLogEntry'
    /flowgraph:
        get:
            summary: Get component FlowGraph
            description: Returns the complete FlowGraph with nodes and edges for all managed components
            tags:
                - Components
                - FlowGraph
            responses:
                "200":
                    description: FlowGraph with nodes and edges
                    content:
                        application/json:
                            schema:
                                type: object
    /flows:
        get:
            summary: List all flows
            description: Returns a list of all visual flows
            tags:
                - Flows
            responses:
                "200":
                    description: List of flows
                    content:
                        application/json:
                            schema:
                                type: object
        post:
            summary: Create a new flow
            description: Creates a new visual flow
            tags:
                - Flows
            responses:
                "201":
                    description: Flow created
                    content:
                        application/json:
                            schema:
                                type: object
                "400":
                    description: Invalid request
    /flows/{id}:
        get:
            summary: Get flow by ID
            description: Returns a single flow by ID
            tags:
                - Flows
            parameters:
                - name: id
                  in: path
                  required: true
                  description: Flow ID
                  schema:
                    type: string
            responses:
                "200":
                    description: Flow details
                    content:
                        application/json:
                            schema:
                                type: object
                "404":
                    description: Flow not found
        put:
            summary: Update flow
            description: Updates an existing flow
            tags:
                - Flows
            responses:
                "200":
                    description: Flow updated
                    content:
                        application/json:
                            schema:
                                type: object
                "404":
                    description: Flow not found
                "409":
                    description: Version conflict
        delete:
            summary: Delete flow
            description: Deletes a flow
            tags:
                - Flows
            responses:
                "204":
                    description: Flow deleted
                "404":
                    description: Flow not found
    /flows/{id}/runtime/health:
        get:
            summary: Get runtime health
            description: Returns health status and timing for flow components (status, uptime, last activity)
            tags:
                - Runtime
            parameters:
                - name: id
                  in: path
                  required: true
                  description: Flow ID
                  schema:
                    type: string
            responses:
                "200":
                    description: Runtime health status
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RuntimeHealthResponse'
                "404":
                    description: Flow not found
    /flows/{id}/runtime/messages:
        get:
            summary: Get runtime messages
            description: Returns filtered message logger entries for flow components (NATS message flow visibility)
            tags:
                - Runtime
            parameters:
                - name: id
                  in: path
                  required: true
                  description: Flow ID
                  schema:
                    type: string
                - name: limit
                  in: query
                  description: 'Maximum number of messages to return (default: 100, max: 1000)'
                  schema:
                    type: integer
            responses:
                "200":
                    description: Runtime message entries
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RuntimeMessagesResponse'
                "404":
                    description: Flow not found
    /flows/{id}/runtime/metrics:
        get:
            summary: Get runtime metrics
            description: Returns runtime metrics for flow components (throughput, errors, queue depth) with graceful degradation
            tags:
                - Runtime
            parameters:
                - name: id
                  in: path
                  required: true
                  description: Flow ID
                  schema:
                    type: string
            responses:
                "200":
                    description: Runtime metrics
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RuntimeMetricsResponse'
                "404":
                    description: Flow not found
    /gaps:
        get:
            summary: Get component flow gaps
            description: Returns disconnected nodes and orphaned ports in the component flow
            tags:
                - Components
                - FlowGraph
            responses:
                "200":
                    description: Component flow gaps and disconnected nodes
                    content:
                        application/json:
                            schema:
                                type: object
    /health:
        get:
            summary: Get component health status
            description: Returns aggregated health status for all managed components
            tags:
                - Components
            responses:
                "200":
                    description: Component health information
                    content:
                        application/json:
                            schema:
                                type: object
    /kv/{bucket}:
        get:
            summary: Query KV bucket
            description: Query NATS KV bucket entries (development/test only)
            tags:
                - MessageLogger
            parameters:
                - name: bucket
                  in: path
                  required: true
                  description: KV bucket name
                  schema:
                    type: string
                - name: pattern
                  in: query
                  description: Key pattern to match (e.g., 'entity.*')
                  schema:
                    type: string
                - name: limit
                  in: query
                  description: 'Maximum number of entries to return (default: 100, max: 1000)'
                  schema:
                    type: integer
            responses:
                "200":
                    description: KV bucket entries
                    content:
                        application/json:
                            schema:
                                type: object
                "403":
                    description: KV query disabled in production
                "404":
                    description: Bucket not found
    /kv/{bucket}/watch:
        get:
            summary: Watch KV bucket changes
            description: Stream KV bucket changes via Server-Sent Events (SSE). Supports pattern filtering and SSE reconnection with event IDs.
            tags:
                - MessageLogger
            parameters:
                - name: bucket
                  in: path
                  required: true
                  description: KV bucket name (e.g., ENTITY_STATES, CONTEXT_INDEX)
                  schema:
                    type: string
                - name: pattern
                  in: query
                  description: 'Key pattern to watch (e.g., ''entity.*''). Default: ''*'' (all keys)'
                  schema:
                    type: string
            responses:
                "200":
                    description: 'SSE stream of KV changes. Events: ''connected'' (initial), ''kv_change'' (updates), ''error'' (failures)'
                "400":
                    description: Invalid bucket name or pattern
                "404":
                    description: Bucket not found
    /list:
        get:
            summary: List all components
            description: Returns a list of all managed components with basic information
            tags:
                - Components
            responses:
                "200":
                    description: List of components
                    content:
                        application/json:
                            schema:
                                type: object
    /paths:
        get:
            summary: Get component data paths
            description: Returns data paths from input components to all reachable components
            tags:
                - Components
                - FlowGraph
            responses:
                "200":
                    description: Data paths through component graph
                    content:
                        application/json:
                            schema:
                                type: object
    /stats:
        get:
            summary: Get message statistics
            description: Returns statistics about processed messages
            tags:
                - MessageLogger
            responses:
                "200":
                    description: Message statistics
                    content:
                        application/json:
                            schema:
                                type: object
    /status/{name}:
        get:
            summary: Get component status
            description: Returns detailed status for a specific component
            tags:
                - Components
            parameters:
                - name: name
                  in: path
                  required: true
                  description: Component name
                  schema:
                    type: string
            responses:
                "200":
                    description: Component status
                    content:
                        application/json:
                            schema:
                                type: object
                "404":
                    description: Component not found
    /status/stream:
        get:
            summary: WebSocket status stream
            description: |
                Real-time flow status updates via WebSocket.

                ## Connection
                Connect with: ws://host/flowbuilder/status/stream?flowId={flowId}

                ## Message Types (Server → Client)
                All messages are wrapped in StatusStreamEnvelope:
                - **flow_status**: Flow state changes (deployed, running, stopped, failed)
                - **component_health**: Component health updates (every 5s)
                - **component_metrics**: Real-time metrics from MetricsForwarder
                - **log_entry**: Log messages from LogForwarder

                ## Filtering (Client → Server)
                Send SubscribeCommand JSON to filter messages:
                - message_types: Array of message types to receive
                - log_level: Minimum log level (DEBUG < INFO < WARN < ERROR)
                - sources: Array of component names to filter by

                ## Example Subscribe Command
                {"command":"subscribe","message_types":["flow_status","log_entry"],"log_level":"WARN"}
            tags:
                - Status
            parameters:
                - name: flowId
                  in: query
                  required: true
                  description: Flow ID to subscribe to for status updates
                  schema:
                    type: string
            responses:
                "101":
                    description: Switching to WebSocket protocol
                "400":
                    description: Missing or invalid flowId parameter
                "404":
                    description: Flow not found
    /subjects:
        get:
            summary: Get monitored subjects
            description: Returns list of NATS subjects being monitored
            tags:
                - MessageLogger
            responses:
                "200":
                    description: List of monitored subjects
                    content:
                        application/json:
                            schema:
                                type: object
    /types:
        get:
            summary: List available component types
            description: Returns array of component metadata including schemas
            tags:
                - Components
            responses:
                "200":
                    description: Array of component types
                    content:
                        application/json:
                            schema:
                                type: object
    /types/{id}:
        get:
            summary: Get component type by ID
            description: Returns metadata and schema for a specific component type
            tags:
                - Components
            parameters:
                - name: id
                  in: path
                  required: true
                  description: Component type ID
                  schema:
                    type: string
            responses:
                "200":
                    description: Component type metadata
                    content:
                        application/json:
                            schema:
                                type: object
                "404":
                    description: Component type not found
    /validate:
        get:
            summary: Validate component flow connectivity
            description: Performs FlowGraph connectivity analysis for operational validation (used by E2E tests)
            tags:
                - Components
                - FlowGraph
            responses:
                "200":
                    description: Flow connectivity analysis results
                    content:
                        application/json:
                            schema:
                                type: object
components:
    schemas:
        ConstitutionResponse:
            properties:
                created_at:
                    type: string
                id:
                    type: string
                modified_at:
                    type: string
                project:
                    type: string
                rule_count:
                    type: integer
                sections:
                    additionalProperties:
                        items:
                            properties:
                                Enforced:
                                    type: boolean
                                ID:
                                    type: string
                                Priority:
                                    type: string
                                Text:
                                    type: string
                            required:
                                - ID
                                - Text
                                - Priority
                                - Enforced
                            type: object
                        type: array
                    type: object
                version:
                    type: string
            required:
                - id
                - project
                - version
                - sections
                - rule_count
                - created_at
                - modified_at
            type: object
        Flow:
            properties:
                connections:
                    items:
                        properties:
                            id:
                                type: string
                            source_node_id:
                                type: string
                            source_port:
                                type: string
                            target_node_id:
                                type: string
                            target_port:
                                type: string
                        required:
                            - id
                            - source_node_id
                            - source_port
                            - target_node_id
                            - target_port
                        type: object
                    type: array
                created_at:
                    format: date-time
                    type: string
                created_by:
                    type: string
                deployed_at:
                    format: date-time
                    nullable: true
                    type: string
                description:
                    type: string
                id:
                    type: string
                last_modified:
                    format: date-time
                    type: string
                name:
                    type: string
                nodes:
                    items:
                        properties:
                            component:
                                type: string
                            config:
                                additionalProperties: {}
                                type: object
                            id:
                                type: string
                            name:
                                type: string
                            position:
                                properties:
                                    x:
                                        type: number
                                    "y":
                                        type: number
                                required:
                                    - x
                                    - "y"
                                type: object
                            type:
                                type: string
                        required:
                            - id
                            - component
                            - type
                            - name
                            - position
                            - config
                        type: object
                    type: array
                runtime_state:
                    type: string
                started_at:
                    format: date-time
                    nullable: true
                    type: string
                stopped_at:
                    format: date-time
                    nullable: true
                    type: string
                updated_at:
                    format: date-time
                    type: string
                version:
                    type: integer
            required:
                - id
                - name
                - version
                - nodes
                - connections
                - runtime_state
                - created_at
                - updated_at
                - last_modified
            type: object
        FlowStatusPayload:
            properties:
                error:
                    type: string
                prev_state:
                    type: string
                state:
                    type: string
                timestamp:
                    type: integer
            required:
                - state
                - prev_state
                - timestamp
            type: object
        HTTPCheckRequest:
            properties:
                content:
                    type: string
                context:
                    additionalProperties:
                        type: string
                    type: object
            required:
                - content
            type: object
        HTTPCheckResponse:
            properties:
                checked_at:
                    type: string
                passed:
                    type: boolean
                violations:
                    items:
                        properties:
                            Location:
                                type: string
                            Message:
                                type: string
                            Rule:
                                properties:
                                    Enforced:
                                        type: boolean
                                    ID:
                                        type: string
                                    Priority:
                                        type: string
                                    Text:
                                        type: string
                                required:
                                    - ID
                                    - Text
                                    - Priority
                                    - Enforced
                                type: object
                            Section:
                                type: string
                        required:
                            - Rule
                            - Section
                            - Message
                            - Location
                        type: object
                    type: array
                warnings:
                    items:
                        properties:
                            Location:
                                type: string
                            Message:
                                type: string
                            Rule:
                                properties:
                                    Enforced:
                                        type: boolean
                                    ID:
                                        type: string
                                    Priority:
                                        type: string
                                    Text:
                                        type: string
                                required:
                                    - ID
                                    - Text
                                    - Priority
                                    - Enforced
                                type: object
                            Section:
                                type: string
                        required:
                            - Rule
                            - Section
                            - Message
                            - Location
                        type: object
                    type: array
            required:
                - passed
                - checked_at
            type: object
        LogEntryPayload:
            properties:
                fields:
                    additionalProperties: {}
                    type: object
                level:
                    type: string
                message:
                    type: string
                source:
                    type: string
            required:
                - level
                - source
                - message
                - fields
            type: object
        MessageLogEntry:
            properties:
                message_id:
                    type: string
                message_type:
                    type: string
                metadata:
                    additionalProperties: {}
                    type: object
                raw_data:
                    format: byte
                    type: string
                subject:
                    type: string
                summary:
                    type: string
                timestamp:
                    format: date-time
                    type: string
            required:
                - timestamp
                - subject
                - summary
            type: object
        MetricEntry:
            properties:
                labels:
                    additionalProperties:
                        type: string
                    type: object
                name:
                    type: string
                type:
                    type: string
                value:
                    type: number
            required:
                - name
                - type
                - value
                - labels
            type: object
        MetricsPayload:
            properties:
                component:
                    type: string
                metrics:
                    items:
                        properties:
                            labels:
                                additionalProperties:
                                    type: string
                                type: object
                            name:
                                type: string
                            type:
                                type: string
                            value:
                                type: number
                        required:
                            - name
                            - type
                            - value
                            - labels
                        type: object
                    type: array
            required:
                - component
                - metrics
            type: object
        ReloadResponse:
            properties:
                message:
                    type: string
                rule_count:
                    type: integer
                success:
                    type: boolean
            required:
                - success
                - rule_count
            type: object
        Rule:
            properties:
                Enforced:
                    type: boolean
                ID:
                    type: string
                Priority:
                    type: string
                Text:
                    type: string
            required:
                - ID
                - Text
                - Priority
                - Enforced
            type: object
        RuleWithSection:
            properties:
                enforced:
                    type: boolean
                id:
                    type: string
                priority:
                    type: string
                section:
                    type: string
                text:
                    type: string
            required:
                - section
                - id
                - text
                - priority
                - enforced
            type: object
        RulesResponse:
            properties:
                count:
                    type: integer
                rules:
                    items:
                        properties:
                            enforced:
                                type: boolean
                            id:
                                type: string
                            priority:
                                type: string
                            section:
                                type: string
                            text:
                                type: string
                        required:
                            - section
                            - id
                            - text
                            - priority
                            - enforced
                        type: object
                    type: array
            required:
                - rules
                - count
            type: object
        RuntimeHealthResponse:
            properties:
                components:
                    items:
                        properties:
                            component:
                                type: string
                            details: {}
                            healthy:
                                type: boolean
                            last_activity:
                                format: date-time
                                nullable: true
                                type: string
                            message:
                                type: string
                            name:
                                type: string
                            start_time:
                                format: date-time
                                nullable: true
                                type: string
                            status:
                                type: string
                            type:
                                type: string
                            uptime_seconds:
                                nullable: true
                                type: number
                        required:
                            - name
                            - component
                            - type
                            - status
                            - healthy
                            - message
                            - details
                        type: object
                    type: array
                overall:
                    properties:
                        degraded_count:
                            type: integer
                        error_count:
                            type: integer
                        running_count:
                            type: integer
                        status:
                            type: string
                    required:
                        - status
                        - running_count
                        - degraded_count
                        - error_count
                    type: object
                timestamp:
                    format: date-time
                    type: string
            required:
                - timestamp
                - overall
                - components
            type: object
        RuntimeMessagesResponse:
            properties:
                limit:
                    type: integer
                messages:
                    items:
                        properties:
                            component:
                                type: string
                            direction:
                                type: string
                            message_id:
                                type: string
                            message_type:
                                type: string
                            metadata:
                                additionalProperties: {}
                                type: object
                            subject:
                                type: string
                            summary:
                                type: string
                            timestamp:
                                type: string
                        required:
                            - timestamp
                            - subject
                            - message_id
                            - component
                            - direction
                            - summary
                        type: object
                    type: array
                note:
                    type: string
                timestamp:
                    type: string
                total:
                    type: integer
            required:
                - timestamp
                - messages
                - total
                - limit
            type: object
        RuntimeMetricsResponse:
            properties:
                components:
                    items:
                        properties:
                            component:
                                type: string
                            error_rate:
                                nullable: true
                                type: number
                            name:
                                type: string
                            queue_depth:
                                nullable: true
                                type: number
                            raw_counters:
                                additionalProperties:
                                    minimum: 0
                                    type: integer
                                nullable: true
                                type: object
                            status:
                                type: string
                            throughput:
                                nullable: true
                                type: number
                            type:
                                type: string
                        required:
                            - name
                            - component
                            - type
                            - status
                        type: object
                    type: array
                prometheus_available:
                    type: boolean
                timestamp:
                    format: date-time
                    type: string
            required:
                - timestamp
                - prometheus_available
                - components
            type: object
        SectionRulesResponse:
            properties:
                count:
                    type: integer
                rules:
                    items:
                        properties:
                            Enforced:
                                type: boolean
                            ID:
                                type: string
                            Priority:
                                type: string
                            Text:
                                type: string
                        required:
                            - ID
                            - Text
                            - Priority
                            - Enforced
                        type: object
                    type: array
                section:
                    type: string
            required:
                - section
                - rules
                - count
            type: object
        StatusStreamEnvelope:
            properties:
                flow_id:
                    type: string
                id:
                    type: string
                payload:
                    format: byte
                    type: string
                timestamp:
                    type: integer
                type:
                    type: string
            required:
                - type
                - id
                - timestamp
                - flow_id
            type: object
        SubscribeCommand:
            properties:
                command:
                    type: string
                log_level:
                    type: string
                message_types:
                    items:
                        type: string
                    type: array
                sources:
                    items:
                        type: string
                    type: array
            required:
                - command
            type: object
        Violation:
            properties:
                Location:
                    type: string
                Message:
                    type: string
                Rule:
                    properties:
                        Enforced:
                            type: boolean
                        ID:
                            type: string
                        Priority:
                            type: string
                        Text:
                            type: string
                    required:
                        - ID
                        - Text
                        - Priority
                        - Enforced
                    type: object
                Section:
                    type: string
            required:
                - Rule
                - Section
                - Message
                - Location
            type: object
tags:
    - name: Components
      description: Component management and monitoring endpoints
    - name: Constitution
      description: Project constitution management - rules, constraints, and compliance checking
    - name: Deployment
      description: Flow deployment and runtime control
    - name: FlowGraph
      description: Component flow analysis and connectivity validation endpoints
    - name: Flows
      description: Visual flow CRUD operations
    - name: MessageLogger
      description: Message observation and debugging endpoints
    - name: Runtime
      description: Runtime metrics and observability
    - name: Status
      description: Real-time status updates
